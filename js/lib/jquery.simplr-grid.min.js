/*
 * jQuery simplrGrid - v1.2.0
 * Javascript DataGrid
 *
 * Copyright (c) 2018 Samuel Weru
 * Released under the MIT license
 */
(function(b){var a={addRow:function(d,f,e){var g=b(document.createElement("TR"));var c=b(document.createElement("TD"));g.append(c.html(d));if(e.dblClick){g.dblclick(e.dblClick)}g.click(function(){if(e.singleSelect){b(this).addClass("selected").siblings().removeClass("selected")}else{if(b(this).hasClass("selected")){b(this).removeClass("selected")}else{b(this).addClass("selected")}}});b.each(f,function(i,k){var h={};if(!b.isEmptyObject(e.columns)){var j=e.columns[i];if(typeof(j)!="undefined"){if(j.hasOwnProperty("css")){h=j.css||h}}}c=b(document.createElement("TD")).attr("name",i).css(h);if(e.resizeColumns){c.html(b(document.createElement("DIV")).html(k))}else{c.html(k)}g.append(c)});return g},buildBody:function(g,i,f){var d=parseInt(f.pager.page);var c=parseInt(f.pager.rows);var h=((d-1)*c)+1;var e=b(document.createElement("TBODY"));for(idx in i){e.append(this.addRow(h++,i[idx],f))}g.append(e)},buildHeader:function(e,g,c){var f=b(document.createElement("THEAD"));var d=b(document.createElement("TH"));f.append(d.html("&nbsp;"));b.each(g[0],function(k,m){var j={};var i="";if(!b.isEmptyObject(c.columns)){if(c.columns.hasOwnProperty(k)){var h=c.columns[k];i=h.name||k;if(h.hasOwnProperty("css")){if(h.css.hasOwnProperty("display")){if(h.css.display.toLowerCase().trim()=="none"){j={display:"none"}}}}}}if(!i){var l=k.split("_");if(l.length>1){i=l.map(function(n){return n[0].toUpperCase()+n.substring(1)}).join(" ")}else{i=k[0].toUpperCase()+k.substring(1)}}f.append(b(document.createElement("TH")).attr("name",k).html(i).css(j))});if(g.length>0){e.append(f);return true}else{return false}},addToolbar:function(d){var c=b(document.createElement("DIV"));c.addClass("simplr-grid-toolbar");b.each(d,function(e,f){c.append(f)});return c},buildPager:function(j,m){var l=b(document.createElement("INPUT"));l.val(m.pager.page);l.addClass("page-num").attr("size",2);var e=b(document.createElement("SELECT"));b.each(m.pager.list,function(n,o){b(e).append(new Option(o))});e.change(function(){m.pager.page=1;m.pager.rows=b(this).val();l.val(m.pager.page);a.loader(j,m,a.rebuildBody)});var d=b(document.createElement("BUTTON")).addClass("sg-first").html("&#171;").attr("title","First");d.click(function(){if(m.pager.page!=1){m.pager.page=1;l.val(m.pager.page);a.loader(j,m,a.rebuildBody)}});var k=b(document.createElement("BUTTON")).addClass("sg-prev").html("&#8249;").attr("title","Previous");k.click(function(){if(m.pager.page>1){m.pager.page--;l.val(m.pager.page);a.loader(j,m,a.rebuildBody)}});var c=b(document.createElement("BUTTON")).addClass("sg-next").html("&#8250;").attr("title","Next");c.click(function(){if(m.pager.page<m.pager.pages){m.pager.page++;l.val(m.pager.page);a.loader(j,m,a.rebuildBody)}});var f=b(document.createElement("BUTTON")).addClass("sg-last").html("&#187;").attr("title","Last");f.click(function(){if(m.pager.page!=m.pager.pages){m.pager.page=m.pager.pages;l.val(m.pager.page);a.loader(j,m,a.rebuildBody)}});var h=b(document.createElement("BUTTON")).addClass("sg-refresh").html("&#8634;").attr("title","Refresh");h.click(function(){m.pager.page=j.parent().parent().find(".page-num").val();a.loader(j,m,a.rebuildBody)});var g="&nbsp;|&nbsp;";var i=b(document.createElement("SPAN"));i.addClass("num-of-pages");i.html(m.pager.pages);return this.addToolbar([e,g,d,k,"<span> Page </span>",l,"<span> of </span>",i,"<span>&nbsp;</span>",c,f,g,h,])},buildToolbars:function(g,h,e){var i=b(document.createElement("DIV"));i.addClass("simplr-grid-capsule");i.css({width:e.css.capsuleWidth});g.css({width:e.css.gridWidth,});var c=g.data("options");g.replaceWith(i);g.data("options",c);g.bind("refresh",function(){a.loader(g,g.data("options"),a.rebuildBody)});var d=b(document.createElement("DIV"));d.addClass("simplr-grid-title");d.html("&nbsp;".concat(e.title));var f=b(document.createElement("DIV"));f.addClass("simplr-grid-inner");f.css({height:e.css.gridHeight});i.append(d);b.each(e.toolbars,function(j,k){i.append(a.addToolbar(k))});if(e.usePager){i.append(a.buildPager(g,e))}i.append(f);f.append(g)},disableToolbar:function(g,d){var f=g.parent().prev();f.find(".sg-last, .sg-next, .sg-prev, .sg-first, .page-num, select").attr("disabled",d);if(d){var e=b("<div>").addClass("msg-outer");var c=b("<div>").addClass("msg-inner").html("No Data");g.parent().not(":has(.msg-outer)").append(e.append(c));f.find(".num-of-pages").html("#")}else{g.parent().find(".msg-outer").remove()}},build:function(d,e,c){a.buildToolbars(d,e,c);if(e.rows.length>0){a.buildHeader(d,e.rows,c);a.buildBody(d,e.rows,c);a.doPlugins(d,c);a.disableToolbar(d,false)}else{a.disableToolbar(d,true)}},rebuildBody:function(d,e,c){d.find("thead").remove();d.find("tbody").remove();setTimeout(function(){if(e.rows.length>0){a.buildHeader(d,e.rows,c);a.buildBody(d,e.rows,c);a.doPlugins(d,c);d.parent().parent().find(".num-of-pages").html(c.pager.pages);a.disableToolbar(d,false)}else{a.disableToolbar(d,true)}},100)},doPlugins:function(d,c){if(c.fixHeader){d.fixHeader()}if(c.fixLeftColumn){d.fixLeftColumn()}else{d.parent().css({overflow:"auto"})}if(c.resizeColumns){d.resizeColumns()}},nativeLoader:function(e,d,c){b.ajax({type:d.method,dataType:"json",url:d.url,data:{page:d.pager.page,rows:d.pager.rows}}).done(function(f){d.pager.pages=Math.ceil(f.count/d.pager.rows);c(e,f,d)})},loader:function(e,d,c){e.addClass("simplr-grid");if(d.data.length>0){c(e,{rows:d.data,count:d.data.length},d);a.doPlugins(e,d)}else{if(d.customLoader){d.customLoader(e,d,c)}else{a.nativeLoader(e,d,c)}}}};b.fn.simplrGrid=function(c){var d={title:"Simplr Grid",toolbars:[],columns:{},pager:{page:1,rows:10,list:[50,40,30,20,10]},css:{},data:[],method:"POST",singleSelect:true,dblClick:null,customLoader:null,usePager:false,fixHeader:false,fixLeftColumn:false,resizeColumns:false};c=b.extend(true,{},d,c);this.data("options",c);return this.each(function(){a.loader(b(this),c,a.build)})};b.fn.getRow=function(c){var d={};b(this).has("td").find("td:not(:first-child)").each(function(e,g){var f=b(g).attr("name");if(b(this).has("div").length){val=b(this).find("div").html()}else{val=b(this).html()}d[f]=val});return d};b.fn.getSelectedRow=function(){return b(this).find("tr.selected:first").getRow()};b.fn.getSelectedRows=function(){var c=[];b.each(b(this).find("tr.selected"),function(e,d){c.push(b(d).getRow())});return c};b.fn.fixHeader=function(){var d={head:true};function e(g){var f=g.parent();f.append(g);f.css({"overflow-x":"auto","overflow-y":"auto"});f.scroll(function(){var h=f.scrollTop();b(this).find("thead > *").css("top",h)}.bind(g))}function c(g){var f=g.find("thead > *");f.css({position:"relative"})}return this.each(function(){e(b(this));c(b(this))})};b.fn.fixLeftColumn=function(){var c={left:1};return this.each(function(){d(b(this));e(b(this));b(this).parent().trigger("scroll");b(window).resize(function(){b(this).parent().trigger("scroll")})});function d(h){var g=h.parent();g.append(h);g.css({"overflow-x":"auto","overflow-y":"auto"});g.scroll(function(){var i=g.scrollLeft();if(c.left>0){c.leftColumns.css("left",i)}}.bind(h))}function e(h){c.leftColumns=b();var i=h.find("tr");i.each(function(j,l){f(l,function(k){c.leftColumns=c.leftColumns.add(k)})});var g=c.leftColumns;g.each(function(l,j){var j=b(j);j.css({position:"relative"})})}function f(n,l){var h=c.left;var m=1;for(var j=1;j<=h;j=j+m){var k=m>1?j-1:j;var g=b(n).find("> *:nth-child("+k+")");var o=g.prop("colspan");l(g);m=o}}};b.fn.resizeColumns=function(){return this.each(function(){var e=false;var f=undefined;var d,c;if(b(this).find("th:last-child").has("span").length==0){b(this).find("th:not(:first-child)").append("<span>&nbsp;</span>")}b(this).find("th span").mousedown(function(g){f=b(this).parent();e=true;d=g.pageX;c=f.width()});b(document).mousemove(function(g){if(e){b(f).width(c+(g.pageX-d))}});b(document).mouseup(function(){if(e){e=false}})})}})(jQuery);