/*
 * jQuery simplrGrid - v1.0.0-alpha1
 * Javascript DataGrid
 *
 * Copyright (c) 2016 Samuel Weru
 * Released under the MIT license
 */
(function(a){a.fn.resizeColumns=function(){return this.each(function(){var d=false;var e=undefined;var c,b;a(this).find("th:not(:first-child)").append("<span>&nbsp;</span>");a(this).find("th span").mousedown(function(f){e=a(this).parent();d=true;c=f.pageX;b=e.width()});a(document).mousemove(function(f){if(d){a(e).width(b+(f.pageX-c))}});a(document).mouseup(function(){if(d){d=false}})})};a.fn.fixHeader=function(){var c={head:true};return this.each(function(){d(a(this));b(a(this))});function d(f){var e=f.parent();e.append(f);e.css({"overflow-x":"auto","overflow-y":"auto"});e.scroll(function(){var g=e.scrollTop();this.find("thead tr > *").css("top",g)}.bind(f))}function b(f){var h=f.find("thead");var g=h.find("tr");var e=h.find("tr > *");e.css({position:"relative"})}};a.fn.fixLeftColumn=function(){var b={left:1};return this.each(function(){c(a(this));d(a(this));a(this).parent().trigger("scroll");a(window).resize(function(){a(this).parent().trigger("scroll")})});function c(g){var f=g.parent();f.append(g);f.css({"overflow-x":"auto","overflow-y":"auto"});f.scroll(function(){var h=f.scrollLeft();if(b.left>0){b.leftColumns.css("left",h)}}.bind(g))}function d(g){b.leftColumns=a();var h=g.find("tr");h.each(function(i,j){e(j,function(k){b.leftColumns=b.leftColumns.add(k)})});var f=b.leftColumns;f.each(function(j,i){var i=a(i);i.css({position:"relative"})})}function e(m,k){var g=b.left;var l=1;for(var h=1;h<=g;h=h+l){var j=l>1?h-1:h;var f=a(m).find("> *:nth-child("+j+")");var n=f.prop("colspan");k(f);l=n}}};a.fn.getSelected=function(){var c=a(this).find("tr.selected:first td");var b={};a.each(c,function(e,d){var f=a(d).attr("field");if(!!f){b[f]=a(d).find("div").html()}});return b};a.fn.getAllSelected=function(){var b=[];a.each(a(this).find("tr.selected"),function(e,d){var c={};a.each(a(d).find("td"),function(g,f){var h=a(f).attr("field");if(!!h){c[h]=a(f).find("div").html()}});b.push(c)});return b};a.fn.simplrGrid=function(d){var h={title:"Simplr Grid",columnHide:[],toolbars:[],pager:{page:1,rows:50,list:[50,40,30,20,10]},css:{},data:[],method:"POST",singleSelect:true,usePager:false,};d.pager=a.extend({},h.pager,d.pager);var f=a.extend({__initGrid:true},h,d);function g(m,j){m.addClass("simplr-grid");var l=a(document.createElement("THEAD"));var k=a(document.createElement("TR"));l.append(k);m.append(l);IdCellTh=a(document.createElement("TH"));k.append(IdCellTh);if(j.data!=undefined){if(j.data.length>0){var i=Object.keys(j.data[0]);a.each(i,function(o,n){var p=a(document.createElement("TH"));p.append(n[0].toUpperCase()+n.substring(1));if(a.inArray(n,j.columnHide)!=-1){p.hide()}k.append(p)})}}}function c(n,l){var k=a(document.createElement("TBODY"));n.append(k);var j=parseInt(l.pager.page);var i=parseInt(l.pager.rows);var m=((j-1)*i)+1;a.each(l.data,function(o,p){var q=a(document.createElement("TR"));if(!!l.onDblClick){q.dblclick(function(s){var u=a(s.currentTarget).find("td");var t={};a.each(u,function(w,v){var x=a(v).attr("field");if(!!x){t[x]=a(v).find("div").html()}});l.onDblClick(t)})}k.append(q);q.click(function(s){if(l.singleSelect){a(s.currentTarget).parent().find("tr.selected").removeClass("selected")}if(a(s.currentTarget).hasClass("selected")){a(s.currentTarget).removeClass("selected")}else{a(s.currentTarget).addClass("selected")}});var r=0;a.each(p,function(u,t){if(r==0){var v=a(document.createElement("TD"));v.css({textAlign:"right",fontWeight:"bold"});v.html(m++);q.append(v)}var s=a(document.createElement("TD"));q.append(s);s.attr("field",u);if(a.inArray(u,l.columnHide)!=-1){s.hide()}s.html(a(document.createElement("DIV")).html(t));r++})});n.css({minWidth:"1000px"})}function b(j,i){var l=parseInt(j);var k=parseInt(i);var m=Math.ceil(l/k);return m}var e=function(i){this.options=i};e.prototype={constructor:e,addToolbar:function(j){var i=a(document.createElement("DIV"));i.addClass("simplr-grid-toolbar");a.each(j,function(k,l){i.append(l)});return i},_reTblEl:function(i){this.options.__initGrid=false;i.find(".simplr-grid tbody").remove();return i.find(".simplr-grid")},_cfgPager:function(i){this.options.pager=a.extend(this.options.pager,i)},_calcPages:function(){return b(this.options.pager.count,this.options.pager.rows)},pager:function(j){var r=this;var s=a(document.createElement("INPUT"));s.val(this.options.pager.page);s.addClass("page-num").attr("size",2);var l=a(document.createElement("SELECT"));a.each(this.options.pager.list,function(t,u){a(l).append(new Option(u))});a(l).val(this.options.pager.rows);l.change(function(){var t=1;r._cfgPager({page:t,rows:parseInt(a(this).val())});s.val(t);r.getData(r._reTblEl(j))});var o=a(document.createElement("BUTTON")).html("|<");o.click(function(){if(r.options.pager.page>1){r.options.pager.page=1;s.val(r.options.pager.page);r.getData(r._reTblEl(j))}});var k=a(document.createElement("BUTTON")).html("<");k.click(function(){if(r.options.pager.page>1){r.options.pager.page--;s.val(r.options.pager.page);r.getData(r._reTblEl(j))}});var n=a(document.createElement("BUTTON")).html(">");n.click(function(){var u=r._calcPages();var t=parseInt(r.options.pager.page);if(t<u){r.options.pager.page++;s.val(r.options.pager.page);r.getData(r._reTblEl(j))}});var q=a(document.createElement("BUTTON")).html(">|");q.click(function(){var u=r._calcPages();var t=parseInt(r.options.pager.page);if(t<u){r.options.pager.page=u;s.val(u);r.getData(r._reTblEl(j))}});var i=a(document.createElement("BUTTON")).html("Refresh");i.click(function(){var u=r._calcPages();var v=s.val();var t=1;if(!isNaN(v)){t=parseInt(v)}if(t>u){t=u}if(v!=t){s.val(t)}r._cfgPager({page:t});r.getData(r._reTblEl(j))});var m="&nbsp;|&nbsp;";var p=a(document.createElement("SPAN"));p.addClass("num-of-pages");return this.addToolbar([l,m,o,k," Page ",s," of ",p,"&nbsp;",n,q,m,i])},createTitle:function(){var i=a(document.createElement("DIV"));i.addClass("simplr-grid-title");i.html("&nbsp;".concat(this.options.title));return i},createCapsule:function(){var j=a(document.createElement("DIV"));j.addClass("simplr-grid-capsule");var i=a(document.createElement("DIV"));i.addClass("simplr-grid-body");j.css({width:this.options.css.width});i.css({height:this.options.css.height});j.append(i);return j},getData:function(j){var i=this;if(!!this.options.url){a.ajax({url:this.options.url,method:this.options.method,data:{page:this.options.pager.page,rows:this.options.pager.rows}}).done(function(k){i.options.data=k.rows;i._cfgPager({count:k.count});if(i.options.__initGrid){g(j,i.options)}c(j,i.options);var l=i._calcPages();j.parent().parent().find(".num-of-pages").html(l)}).fail(function(){console.log("Ajax Error!")})}else{if(this.options.__initGrid){g(j,this.options)}c(j,this.options)}}};return this.each(function(){var k=new e(f);var i=k.createCapsule();k.getData(a(this));a(this).wrap(i);var j=a(this).parent();j.before(k.createTitle());a.each(f.toolbars,function(l,m){j.before(k.addToolbar(m))});if(f.usePager){j.before(k.pager(j))}})}})(jQuery);